{# 
    Template navigateur pour affichage d’un ticket
    Variables disponibles :
    - ticket : entité Ticket
    - ticket.commande : entité Commande associée
    - qrCodeBase64 : QR code PNG encodé en base64
#}

{% extends 'base.html.twig' %}

{% block title %}
	Ticket n°
	{{ ticket.id }}
	payé le :
	{{ ticket.commande.payeeLe|date('d/m/Y à H:i') }}
{% endblock %}

{% block body %}

	<a href="{{ path('app_commandes_liste-commandes-client', {id: app.user.id}) }}" class="btn btn-primary">
		<i class="fa-solid fa-clipboard-list"></i>
		Revenir à la liste des commandes
	</a>

	{# Conteneur principal centré horizontalement #}
	<div
		style="display:flex; justify-content:center; background:#f8f8f8; padding:20px 0;">

		{# Ticket box : largeur fixe, texte centré, cadre et ombre #}
		<div
			style="width:400px; max-width:90%; padding:20px; background:#fff; border:1px solid #ccc; border-radius:10px; text-align:center; box-sizing:border-box; word-break:break-all; box-shadow:0 0 6px rgba(0,0,0,0.1);">

			{# Référence de la commande #}
			<div style="text-align:left;">
				<strong>Commande :</strong>
				{{ ticket.commande.reference }}</div>

			{# Date de paiement formatée #}
			<div style="text-align:left;">
				<strong>Payée le :</strong>
				{{ ticket.commande.payeeLe|date('d/m/Y à H:i') }}</div>

			{# QR code si disponible #}
			{% if qrCodeBase64 %}
				<div style="margin:15px auto; width:100%; display:flex; justify-content:center;">
					<img src="{{ qrCodeBase64 }}" alt="QR Code du ticket" style="width:180px; height:180px; object-fit:contain;">
				</div>
			{% else %}
				<p style="color:#888; font-style:italic;">QR code non disponible</p>
			{% endif %}

			{# Clé unique du ticket #}
			<div style="font-size:11px; line-height:1.3; word-break:break-all;">
				<strong>Clé :</strong>
				{{ ticket.ticketKey }}
			</div>

			{# Hash sécurisé du ticket #}
			<div style="font-size:11px; line-height:1.3; word-break:break-all;">
				<strong>Hash :</strong>
				{{ ticket.payloadHash }}
			</div>

		</div>
	</div>

	{# Lien pour imprimer ce ticket dans une nouvelle fenêtre #}

	<a class="btn btn-primary" href="{{ path('app_ticket_pdf', {ticketKey: ticket.ticketKey}) }}" target="_blank">
		<i class="fa-solid fa-print"></i>
		Imprimer le ticket
	</a>

{% endblock %}
