{% extends 'base.html.twig' %}

{% block title %}
	Mes commandes en cours
{% endblock %}

{% block body %}
	<h1 class="text-center">
		<i class="fa-solid fa-list-check"></i>
		Mes commandes en cours
	</h1>

	<table class="table table-striped table-hover">
		<thead>
			<tr>
				<th>Référence</th>
				<th>Date</th>
				<th>Total</th>
				<th>Paiement</th>
				<th>Status ticket</th>
				<th></th>
			</tr>
		</thead>
		<tbody>
			{% for c in commandes %}
				<tr>
					<td data-label="Référence">
						<a href="{{ path('app_commandes_show', {id: c.id}) }}">
							<i class="fa-solid fa-folder-open"></i>
							{{ c.reference }}
						</a>
					</td>
					<td data-label="Enregistrée le">{{ c.createdAt|date('d/m/Y H:i') }}</td>
					<td data-label="Total TTC">
						<strong>{{ c.totalCommande }}</strong>
						€</td>
					<td>
						{% if c.payeeLe is null %}
							<div class="row">
								<a href="{{ path('app_paiement_commande', {id: c.id}) }}" class="btn btn-primary">
									<i class="fa-regular fa-credit-card"></i>
									Procéder au paiement
								</a>
								{# Formulaire de suppression de commande #}
								<form action="{{ path('app_commandes_supprimer', { id: c.id }) }}" method="post" onsubmit="return confirm('Confirmer la suppression ?');">
									<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ c.id) }}">
									<button type="submit" class="btn btn-danger">
										<i class="fa-solid fa-trash-can"></i>Annuler la commande
									</button>
								</form>
							</div>
						{% else %}
							<p class="text-success">
								<i class="fa-regular fa-circle-check"></i>
								Payée le
								{{ c.payeeLe|date('d/m/Y à H:i:s') }}
							</p>
						{% endif %}
					</td>
					<td data-label="Statut ticket">
						{% if c.dateScan %}
							<span class="badge bg-success">
								✅ Scanné le
								{{ c.dateScan|date('d/m/Y H:i') }}
								{% if c.scannedBy %}
									par
									{{ c.scannedBy.nom }}
								{% endif %}
							</span>
						{% else %}
							<span class="badge bg-warning text-dark">⏳ Non scanné</span>
						{% endif %}
					</td>
					<td>
						{% if c.ticket is defined %}
							<a href="{{ path('app_ticket_show', {ticketKey: c.ticket.ticketKey}) }}" class="btn btn-primary">
								<i class="fa-solid fa-ticket"></i>Voir ticket
							</a>
						{% endif %}
					</td>
				</tr>
			{% else %}
				<tr>
					<td colspan="6" class="text-center">Aucune commande trouvée.</td>
				</tr>
			{% endfor %}
		</tbody>
	</table>
{% endblock %}

{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('assets/css/table.css') }}">
	<link rel="stylesheet" href="{{ asset('assets/css/filters.css') }}">
{% endblock %}
