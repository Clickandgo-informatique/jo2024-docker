@startuml
title Réinitialisation de mot de passe - Workflow avec token

actor Utilisateur as U
participant "Front-End\nTwig + JS" as FE
participant "Contrôleur Symfony\nPasswordResetController" as Controller
participant "Service Email\nMailer" as EmailService
database "Base de données\nUser / Token" as DB

== Étape 1 : Demande de réinitialisation ==
U -> FE : Cliquer sur "Mot de passe oublié"
FE -> Controller : POST /reset-password (email)
activate Controller
Controller -> DB : Vérifie si email existe
DB --> Controller : Utilisateur trouvé
Controller -> DB : Génère token unique + date d'expiration
Controller --> DB : Sauvegarde token
Controller -> EmailService : Envoie email avec lien /reset-password/{token}
EmailService --> U : Email envoyé avec lien sécurisé
deactivate Controller

== Étape 2 : Ouverture du lien ==
U -> FE : Clique sur lien /reset-password/{token}
FE -> Controller : GET /reset-password/{token}
activate Controller
Controller -> DB : Vérifie validité du token et expiration
DB --> Controller : Token valide
Controller --> FE : Affiche formulaire de nouveau mot de passe
deactivate Controller

== Étape 3 : Soumission du nouveau mot de passe ==
U -> FE : Saisir nouveau mot de passe + confirmation
FE -> Controller : POST /reset-password/{token} (nouveau mot de passe)
activate Controller
Controller -> DB : Vérifie token encore valide
DB --> Controller : Token valide
Controller -> DB : Met à jour mot de passe + supprime token
DB --> Controller : Confirmation
Controller --> FE : Réponse succès / redirection login
FE --> U : Mot de passe réinitialisé

note right of Controller
  ⚙️ Token :
  - Long, aléatoire, unique
  - Expiration (ex: 1h)
  - Stocké haché ou brut selon sécurité
end note

@enduml
