{% extends 'base.html.twig' %}

{% block title %}Liste commandes client
{% endblock %}

{% block body %}
	<h1 class="text-center">Liste commandes client</h1>

	{% if commandes %}
		<table>
			<thead>
				<tr>
					<th>Référence</th>
					<th>Payée le</th>
					<th>Scannée le</th>
					<th>Par</th>
					<th>Créée le</th>
					<th>Actions</th>
				</tr>
			</thead>
			<tbody>
				{% for c in commandes %}
					<tr>
						<td>{{ c.reference }}</td>
						<td>{{ c.payeeLe|date('d/m/Y H:i:s') }}</td>
						<td>{{ c.dateScan ? c.dateScan|date('d/m/Y H:i:s') : '' }}</td>
						<td>{{ c.scannedBy ?: '' }}</td>
						<td>{{ c.createdAt|date('d/m/Y H:i:s') }}</td>
						<td>
							<form action="{{ path('app_commandes_supprimer', {'id': c.id}) }}" method="post" onsubmit="return confirm('Voulez-vous vraiment supprimer cette commande ?');">
								<input type="hidden" name="_token" value="{{ csrf_token('supprimer' ~ c.id) }}">
								<button type="submit" class="btn-action btn-delete">
									<i class="fa-regular fa-trash-can"></i>
								</button>
							</form>
						</td>
					</tr>
					{# Sous-table pour les tickets de la commande #}
					{% if c.ticket is not null %}
						<tr>
							<td colspan="6">
								<table class="sub-table">
									<thead>
										<tr>
											<th>Ticket Key</th>
											<th>Créé le</th>
											<th>QR Code</th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td>{{ c.ticket.ticketKey }}</td>
											<td>{{ c.ticket.createdAt|date('d/m/Y H:i:s') }}</td>
											<td>
												<img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data={{ c.ticket.qrcodePath }}" alt="QR code ticket">
											</td>
										</tr>
									</tbody>
								</table>
							</td>
						</tr>
					{% endif %}
				{% endfor %}
			</tbody>
		</table>
	{% else %}
		<p>Il n'existe encore aucune commande pour ce client</p>
	{% endif %}
{% endblock %}
